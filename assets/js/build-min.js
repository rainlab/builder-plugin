+function(t){"use strict";void 0===t.oc.builder&&(t.oc.builder={});var e=t.oc.foundation.base,o=e.prototype,i=function(){this.data={},this.requestCache={},this.callbackCache={},e.call(this)};i.prototype.set=function(t,e,o,i,r){this.storeData(t,e,o,i),"localization"!=e||o||this.localizationUpdated(t,r)},i.prototype.get=function(t,e,o,i,r){return void 0===this.data[e]||void 0===this.data[e][o]||void 0===this.data[e][o][i]||this.isCacheObsolete(this.data[e][o][i].timestamp)?this.loadDataFromServer(t,e,o,i,r):void r(this.data[e][o][i].data)},i.prototype.makeCacheKey=function(t,e,o){var i=t+"-"+e;return o&&(i+="-"+o),i},i.prototype.isCacheObsolete=function(t){return Date.now()-t>3e5},i.prototype.loadDataFromServer=function(t,e,o,i,r){var n=this,a=this.makeCacheKey(e,o,i);return void 0===this.requestCache[a]&&(this.requestCache[a]=t.request("onPluginDataRegistryGetData",{data:{registry_plugin_code:e,registry_data_type:o,registry_data_subtype:i}}).done(function(t){if(void 0===t.registryData)throw new Error("Invalid data registry response.");n.storeData(e,o,i,t.registryData),n.applyCallbacks(a,t.registryData),n.requestCache[a]=void 0})),this.addCallbackToQueue(r,a),this.requestCache[a]},i.prototype.addCallbackToQueue=function(t,e){void 0===this.callbackCache[e]&&(this.callbackCache[e]=[]),this.callbackCache[e].push(t)},i.prototype.applyCallbacks=function(t,e){if(void 0!==this.callbackCache[t]){for(var o=this.callbackCache[t].length-1;o>=0;o--)this.callbackCache[t][o](e);delete this.callbackCache[t]}},i.prototype.storeData=function(t,e,o,i){void 0===this.data[t]&&(this.data[t]={}),void 0===this.data[t][e]&&(this.data[t][e]={});var r={timestamp:Date.now(),data:i};this.data[t][e][o]=r},i.prototype.clearCache=function(t,e){void 0!==this.data[t]&&void 0!==this.data[t][e]&&(this.data[t][e]=void 0)},i.prototype.getLocalizationString=function(t,e,o,i){this.get(t,e,"localization",null,function(t){return void 0!==t[o]?void i(t[o]):void i(o)})},i.prototype.localizationUpdated=function(e,o){t.oc.builder.localizationInput.updatePluginInputs(e),void 0!==o&&o.suppressLanguageEditorUpdate||t.oc.builder.indexController.entityControllers.localization.languageUpdated(e),t.oc.builder.indexController.entityControllers.localization.updateOnScreenStrings(e)},t.oc.builder.dataRegistry=new i}(window.jQuery),+function(t){"use strict";void 0===t.oc.builder&&(t.oc.builder={}),void 0===t.oc.builder.entityControllers&&(t.oc.builder.entityControllers={});var e=t.oc.foundation.base,o=e.prototype,i=function(t,o){if(void 0===t)throw new Error("The Builder entity type name should be set in the base constructor call.");if(void 0===o)throw new Error("The Builder index controller should be set when creating an entity controller.");this.typeName=t,this.indexController=o,e.call(this)};i.prototype=Object.create(o),i.prototype.constructor=i,i.prototype.registerHandlers=function(){},i.prototype.invokeCommand=function(t,e){if(!/^cmd[a-zA-Z0-9]+$/.test(t))throw new Error("Invalid command: "+t);if(void 0===this[t])throw new Error("Unknown command: "+t);this[t].apply(this,[e])},i.prototype.newTabId=function(){return this.typeName+Math.random()},i.prototype.makeTabId=function(t){return this.typeName+"-"+t},i.prototype.getMasterTabsActivePane=function(){return this.indexController.getMasterTabActivePane()},i.prototype.getMasterTabsObject=function(){return this.indexController.masterTabsObj},i.prototype.getSelectedPlugin=function(){var e=t("#PluginList-pluginList-plugin-list > ul > li.active");return e.data("id")},i.prototype.getIndexController=function(){return this.indexController},i.prototype.updateMasterTabIdAndTitle=function(t,e){var o=this.getMasterTabsObject();o.updateIdentifier(t,e.tabId),o.updateTitle(t,e.tabTitle)},i.prototype.unhideFormDeleteButton=function(e){t("[data-control=delete-button]",e).removeClass("hide")},i.prototype.forceCloseTab=function(t){t.trigger("close.oc.tab",[{force:!0}])},i.prototype.unmodifyTab=function(t){this.indexController.unchangeTab(t)},t.oc.builder.entityControllers.base=i}(window.jQuery),+function(t){"use strict";void 0===t.oc.builder&&(t.oc.builder={}),void 0===t.oc.builder.entityControllers&&(t.oc.builder.entityControllers={});var e=t.oc.builder.entityControllers.base,o=e.prototype,i=function(t){e.call(this,"controller",t)};i.prototype=Object.create(o),i.prototype.constructor=i,i.prototype.cmdCreateController=function(e){var o=t(e.currentTarget),i=this,r=o.data("pluginCode"),n=o.find('input[name="behaviors[]"]:checked').length,a=null;a=n?this.indexController.openOrLoadMasterTab(o,"onControllerCreate",this.makeTabId(r+"-new-controller"),{}):o.request("onControllerCreate"),a.done(function(t){o.trigger("close.oc.popup"),i.updateDataRegistry(t)}).always(t.oc.builder.indexController.hideStripeIndicatorProxy)},i.prototype.cmdOpenController=function(e){var o=t(e.currentTarget).data("id"),i=t(e.currentTarget).data("pluginCode");this.indexController.openOrLoadMasterTab(t(e.target),"onControllerOpen",this.makeTabId(i+"-"+o),{controller:o})},i.prototype.cmdSaveController=function(e){var o=t(e.currentTarget),i=o.closest("form"),r=i.find(".inspector-container");t.oc.inspector.manager.applyValuesFromContainer(r)&&o.request("onControllerSave").done(this.proxy(this.saveControllerDone))},i.prototype.saveControllerDone=function(t){if(void 0===t.builderResponseData)throw new Error("Invalid response data");var e=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(e)},i.prototype.updateDataRegistry=function(e){if(void 0!==e.builderResponseData.registryData){var o=e.builderResponseData.registryData;t.oc.builder.dataRegistry.set(o.pluginCode,"controller-urls",null,o.urls)}},i.prototype.getControllerList=function(){return t("#layout-side-panel form[data-content-id=controller] [data-control=filelist]")},t.oc.builder.entityControllers.controller=i}(window.jQuery),+function(t){"use strict";void 0===t.oc.builder&&(t.oc.builder={}),void 0===t.oc.builder.entityControllers&&(t.oc.builder.entityControllers={});var e=t.oc.builder.entityControllers.base,o=e.prototype,i=function(t){e.call(this,"databaseTable",t)};i.prototype=Object.create(o),i.prototype.constructor=i,i.prototype.cmdCreateTable=function(e){this.indexController.openOrLoadMasterTab(t(e.target),"onDatabaseTableCreateOrOpen",this.newTabId())},i.prototype.cmdOpenTable=function(e){var o=t(e.currentTarget).data("id");this.indexController.openOrLoadMasterTab(t(e.target),"onDatabaseTableCreateOrOpen",this.makeTabId(o),{table_name:o})},i.prototype.cmdSaveTable=function(e){var o=t(e.currentTarget);if(this.validateTable(o)){var i={columns:this.getTableData(o)};o.popup({extraData:i,handler:"onDatabaseTableValidateAndShowPopup"})}},i.prototype.cmdSaveMigration=function(e){var o=t(e.currentTarget);t.oc.stripeLoadIndicator.show(),o.request("onDatabaseTableMigrationApply").always(t.oc.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.saveMigrationDone))},i.prototype.cmdDeleteTable=function(e){var o=t(e.currentTarget);t.oc.confirm(o.data("confirm"),this.proxy(this.deleteConfirmed))},i.prototype.cmdUnModifyForm=function(){var t=this.getMasterTabsActivePane();this.unmodifyTab(t)},i.prototype.onTableCellChanged=function(e,o,i,r){var n=t(e.target);if("columns"==n.data("alias")&&"database"==n.closest("form").data("entity")){var a={};"auto_increment"==o&&i&&(a.unsigned=1,a.primary_key=1),"unsigned"!=o||i||(a.auto_increment=0),"primary_key"==o&&i&&(a.allow_null=0),"allow_null"==o&&i&&(a.primary_key=0),"primary_key"!=o||i||(a.auto_increment=0),n.table("setRowValues",r,a)}},i.prototype.registerHandlers=function(){this.indexController.$masterTabs.on("oc.tableCellChanged",this.proxy(this.onTableCellChanged))},i.prototype.validateTable=function(t){var e=this.getTableControlObject(t);return e.unfocusTable(),e.validate()},i.prototype.getTableData=function(t){var e=this.getTableControlObject(t);return e.dataSource.getAllData()},i.prototype.getTableControlObject=function(t){var e=t.closest("form"),o=e.find("[data-control=table]"),i=o.data("oc.table");if(!i)throw new Error("Table object is not found on the database table tab");return i},i.prototype.saveMigrationDone=function(e){if(void 0===e.builderResponseData)throw new Error("Invalid response data");t("#builderTableMigrationPopup").trigger("close.oc.popup");var o=this.getMasterTabsActivePane(),i=this.getMasterTabsObject();"delete"!=e.builderResponseData.operation?(o.find("input[name=table_name]").val(e.builderResponseData.builderObjectName),this.updateMasterTabIdAndTitle(o,e.builderResponseData),this.unhideFormDeleteButton(o),this.getTableList().fileList("markActive",e.builderResponseData.tabId),this.getIndexController().unchangeTab(o)):this.forceCloseTab(o),t.oc.builder.dataRegistry.clearCache(e.builderResponseData.pluginCode,"model-columns")},i.prototype.getTableList=function(){return t("#layout-side-panel form[data-content-id=database] [data-control=filelist]")},i.prototype.deleteConfirmed=function(){var t=this.getMasterTabsActivePane();t.find("form").popup({handler:"onDatabaseTableShowDeletePopup"})},t.oc.builder.entityControllers.databaseTable=i}(window.jQuery),+function(t){"use strict";void 0===t.oc.builder&&(t.oc.builder={}),void 0===t.oc.builder.entityControllers&&(t.oc.builder.entityControllers={});var e=t.oc.builder.entityControllers.base,o=e.prototype,i=function(t){e.call(this,"localization",t)};i.prototype=Object.create(o),i.prototype.constructor=i,i.prototype.cmdCreateLanguage=function(e){this.indexController.openOrLoadMasterTab(t(e.target),"onLanguageCreateOrOpen",this.newTabId())},i.prototype.cmdOpenLanguage=function(e){var o=t(e.currentTarget).data("id"),i=t(e.currentTarget).data("pluginCode");this.indexController.openOrLoadMasterTab(t(e.target),"onLanguageCreateOrOpen",this.makeTabId(i+"-"+o),{original_language:o})},i.prototype.cmdSaveLanguage=function(e){var o=t(e.currentTarget),i=o.closest("form");o.request("onLanguageSave").done(this.proxy(this.saveLanguageDone))},i.prototype.cmdDeleteLanguage=function(e){var o=t(e.currentTarget);t.oc.confirm(o.data("confirm"),this.proxy(this.deleteConfirmed))},i.prototype.cmdCopyMissingStrings=function(e){var o=t(e.currentTarget),i=o.find("select[name=language]").val(),r=this.getMasterTabsActivePane();o.trigger("close.oc.popup"),t.oc.stripeLoadIndicator.show(),r.find("form").request("onLanguageCopyStringsFrom",{data:{copy_from:i}}).always(t.oc.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.copyStringsFromDone))},i.prototype.languageUpdated=function(e){var o=this.findDefaultLanguageForm(e);if(o){var i=t(o);i.hasClass("oc-data-changed")?this.mergeLanguageFromServer(i):this.updateLanguageFromServer(i)}},i.prototype.updateOnScreenStrings=function(e){var o=document.body.querySelectorAll('span[data-localization-key][data-plugin="'+e+'"]');t.oc.builder.dataRegistry.get(t("#builder-plugin-selector-panel form"),e,"localization",null,function(t){for(var e=o.length-1;e>=0;e--){var i=o[e],r=i.getAttribute("data-localization-key");i.textContent=void 0!==t[r]?t[r]:r}})},i.prototype.saveLanguageDone=function(e){if(void 0===e.builderResponseData)throw new Error("Invalid response data");var o=this.getMasterTabsActivePane();if(o.find("input[name=original_language]").val(e.builderResponseData.language),this.updateMasterTabIdAndTitle(o,e.builderResponseData),this.unhideFormDeleteButton(o),this.getLanguageList().fileList("markActive",e.builderResponseData.tabId),this.getIndexController().unchangeTab(o),void 0!==e.builderResponseData.registryData){var i=e.builderResponseData.registryData;t.oc.builder.dataRegistry.set(i.pluginCode,"localization",null,i.strings,{suppressLanguageEditorUpdate:!0}),t.oc.builder.dataRegistry.set(i.pluginCode,"localization","sections",i.sections)}},i.prototype.getLanguageList=function(){return t("#layout-side-panel form[data-content-id=localization] [data-control=filelist]")},i.prototype.getCodeEditor=function(t){return t.find("div[data-field-name=strings] div[data-control=codeeditor]").data("oc.codeEditor").editor},i.prototype.deleteConfirmed=function(){var e=this.getMasterTabsActivePane(),o=e.find("form");t.oc.stripeLoadIndicator.show(),o.request("onLanguageDelete").always(t.oc.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.deleteDone))},i.prototype.deleteDone=function(){var t=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(t),this.forceCloseTab(t)},i.prototype.copyStringsFromDone=function(e){if(void 0===e.builderResponseData)throw new Error("Invalid response data");var o=e.builderResponseData,i=this.getMasterTabsActivePane(),r=i.find("form"),n=this.getCodeEditor(i),a=r.data("newStringMessage"),s=r.data("structureMismatch");n.getSession().setValue(o.strings);for(var l=[],d=o.updatedLines.length-1;d>=0;d--){var p=o.updatedLines[d];l.push({row:p,column:0,text:a,type:"warning"})}n.getSession().setAnnotations(l),o.mismatch&&t.oc.alert(s)},i.prototype.findDefaultLanguageForm=function(t){for(var e=document.body.querySelectorAll("form[data-entity=localization]"),o=e.length-1;o>=0;o--){var i=e[o],r=i.querySelector("input[name=plugin_code]"),n=i.querySelector("input[name=original_language]");if(r&&r.value==t&&n&&i.getAttribute("data-default-language")==n.value)return i}return null},i.prototype.updateLanguageFromServer=function(t){var e=this;t.request("onLanguageGetStrings").done(function(o){e.updateLanguageFromServerDone(t,o)})},i.prototype.updateLanguageFromServerDone=function(t,e){if(void 0===e.builderResponseData)throw new Error("Invalid response data");var o=e.builderResponseData,i=t.closest(".tab-pane"),r=this.getCodeEditor(i);o.strings&&(r.getSession().setValue(o.strings),this.unmodifyTab(i))},i.prototype.mergeLanguageFromServer=function(t){var e=t.find("input[name=original_language]").val(),o=this;t.request("onLanguageCopyStringsFrom",{data:{copy_from:e}}).done(function(e){o.mergeLanguageFromServerDone(t,e)})},i.prototype.mergeLanguageFromServerDone=function(t,e){if(void 0===e.builderResponseData)throw new Error("Invalid response data");var o=e.builderResponseData,i=t.closest(".tab-pane"),r=this.getCodeEditor(i);r.getSession().setValue(o.strings),r.getSession().setAnnotations([])},t.oc.builder.entityControllers.localization=i}(window.jQuery),+function(t){"use strict";void 0===t.oc.builder&&(t.oc.builder={}),void 0===t.oc.builder.entityControllers&&(t.oc.builder.entityControllers={});var e=t.oc.builder.entityControllers.base,o=e.prototype,i=function(t){e.call(this,"menus",t)};i.prototype=Object.create(o),i.prototype.constructor=i,i.prototype.cmdOpenMenus=function(e){var o=this.getSelectedPlugin();return o?void this.indexController.openOrLoadMasterTab(t(e.target),"onMenusOpen",this.makeTabId(o)):void alert("Please select a plugin first")},i.prototype.cmdSaveMenus=function(e){var o=t(e.currentTarget),i=o.closest("form"),r=i.find(".inspector-container");if(t.oc.inspector.manager.applyValuesFromContainer(r)){var n=t.oc.builder.menubuilder.controller.getJson(i.get(0));o.request("onMenusSave",{data:{menus:n}}).done(this.proxy(this.saveMenusDone))}},i.prototype.cmdAddMainMenuItem=function(e){t.oc.builder.menubuilder.controller.addMainMenuItem(e)},i.prototype.cmdAddSideMenuItem=function(e){t.oc.builder.menubuilder.controller.addSideMenuItem(e)},i.prototype.cmdDeleteMenuItem=function(e){t.oc.builder.menubuilder.controller.deleteMenuItem(e)},i.prototype.saveMenusDone=function(t){if(void 0===t.builderResponseData)throw new Error("Invalid response data");var e=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(e)},t.oc.builder.entityControllers.menus=i}(window.jQuery),+function(t){"use strict";void 0===t.oc.builder&&(t.oc.builder={}),void 0===t.oc.builder.entityControllers&&(t.oc.builder.entityControllers={});var e=t.oc.builder.entityControllers.base,o=e.prototype,i=function(t){e.call(this,"model",t)};i.prototype=Object.create(o),i.prototype.constructor=i,i.prototype.cmdCreateModel=function(e){var o=t(e.currentTarget);o.one("shown.oc.popup",this.proxy(this.onModelPopupShown)),o.popup({handler:"onModelLoadPopup"})},i.prototype.cmdApplyModelSettings=function(e){var o=t(e.currentTarget),i=this;t.oc.stripeLoadIndicator.show(),o.request("onModelSave").always(t.oc.builder.indexController.hideStripeIndicatorProxy).done(function(t){o.trigger("close.oc.popup"),i.applyModelSettingsDone(t)})},i.prototype.onModelPopupShown=function(e,o,i){t(i).find("input[name=className]").focus()},i.prototype.applyModelSettingsDone=function(e){if(void 0!==e.builderResponseData.registryData){var o=e.builderResponseData.registryData;t.oc.builder.dataRegistry.set(o.pluginCode,"model-classes",null,o.models)}},t.oc.builder.entityControllers.model=i}(window.jQuery),+function(t){"use strict";void 0===t.oc.builder&&(t.oc.builder={}),void 0===t.oc.builder.entityControllers&&(t.oc.builder.entityControllers={});var e=t.oc.builder.entityControllers.base,o=e.prototype,i=function(t){e.call(this,"modelForm",t)};i.prototype=Object.create(o),i.prototype.constructor=i,i.prototype.cmdCreateForm=function(e){var o=t(e.currentTarget),i={model_class:o.data("modelClass")};this.indexController.openOrLoadMasterTab(o,"onModelFormCreateOrOpen",this.newTabId(),i)},i.prototype.cmdSaveForm=function(e){var o=t(e.currentTarget),i=o.closest("form"),r=t("[data-root-control-wrapper] > [data-contol-container]",i),n=i.find(".inspector-container"),a=t.oc.builder.formbuilder.domToPropertyJson.convert(r.get(0));if(t.oc.inspector.manager.applyValuesFromContainer(n)){if(a===!1)return void t.oc.flashMsg({text:t.oc.builder.formbuilder.domToPropertyJson.getLastError(),"class":"error",interval:5});var s={controls:a};o.request("onModelFormSave",{data:s}).done(this.proxy(this.saveFormDone))}},i.prototype.cmdOpenForm=function(e){var o=t(e.currentTarget).data("form"),i=t(e.currentTarget).data("modelClass");this.indexController.openOrLoadMasterTab(t(e.target),"onModelFormCreateOrOpen",this.makeTabId(i+"-"+o),{file_name:o,model_class:i})},i.prototype.cmdDeleteForm=function(e){var o=t(e.currentTarget);t.oc.confirm(o.data("confirm"),this.proxy(this.deleteConfirmed))},i.prototype.cmdAddControl=function(e){t.oc.builder.formbuilder.controlPalette.addControl(e)},i.prototype.cmdUndockControlPalette=function(e){t.oc.builder.formbuilder.controlPalette.undockFromContainer(e)},i.prototype.cmdDockControlPalette=function(e){t.oc.builder.formbuilder.controlPalette.dockToContainer(e)},i.prototype.cmdCloseControlPalette=function(e){t.oc.builder.formbuilder.controlPalette.closeInContainer(e)},i.prototype.saveFormDone=function(t){if(void 0===t.builderResponseData)throw new Error("Invalid response data");var e=this.getMasterTabsActivePane();e.find("input[name=file_name]").val(t.builderResponseData.builderObjectName),this.updateMasterTabIdAndTitle(e,t.builderResponseData),this.unhideFormDeleteButton(e),this.getModelList().fileList("markActive",t.builderResponseData.tabId),this.getIndexController().unchangeTab(e),this.updateDataRegistry(t)},i.prototype.updateDataRegistry=function(e){if(void 0!==e.builderResponseData.registryData){var o=e.builderResponseData.registryData;t.oc.builder.dataRegistry.set(o.pluginCode,"model-forms",o.modelClass,o.forms)}},i.prototype.deleteConfirmed=function(){var e=this.getMasterTabsActivePane(),o=e.find("form");t.oc.stripeLoadIndicator.show(),o.request("onModelFormDelete").always(t.oc.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.deleteDone))},i.prototype.deleteDone=function(t){var e=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(e),this.forceCloseTab(e),this.updateDataRegistry(t)},i.prototype.getModelList=function(){return t("#layout-side-panel form[data-content-id=models] [data-control=filelist]")},t.oc.builder.entityControllers.modelForm=i}(window.jQuery),+function(t){"use strict";void 0===t.oc.builder&&(t.oc.builder={}),void 0===t.oc.builder.entityControllers&&(t.oc.builder.entityControllers={});var e=t.oc.builder.entityControllers.base,o=e.prototype,i=function(t){this.cachedModelFieldsPromises={},e.call(this,"modelList",t)};i.prototype=Object.create(o),i.prototype.constructor=i,i.prototype.registerHandlers=function(){t(document).on("autocompleteitems.oc.table",'form[data-sub-entity="model-list"] [data-control=table]',this.proxy(this.onAutocompleteItems))},i.prototype.cmdCreateList=function(e){var o=t(e.currentTarget),i={model_class:o.data("modelClass")};this.indexController.openOrLoadMasterTab(o,"onModelListCreateOrOpen",this.newTabId(),i)},i.prototype.cmdSaveList=function(e){var o=t(e.currentTarget),i=o.closest("form");this.validateTable(o)&&o.request("onModelListSave",{data:{columns:this.getTableData(o)}}).done(this.proxy(this.saveListDone))},i.prototype.cmdOpenList=function(e){var o=t(e.currentTarget).data("list"),i=t(e.currentTarget).data("modelClass");this.indexController.openOrLoadMasterTab(t(e.target),"onModelListCreateOrOpen",this.makeTabId(i+"-"+o),{file_name:o,model_class:i})},i.prototype.cmdDeleteList=function(e){var o=t(e.currentTarget);t.oc.confirm(o.data("confirm"),this.proxy(this.deleteConfirmed))},i.prototype.saveListDone=function(t){if(void 0===t.builderResponseData)throw new Error("Invalid response data");var e=this.getMasterTabsActivePane();e.find("input[name=file_name]").val(t.builderResponseData.builderObjectName),this.updateMasterTabIdAndTitle(e,t.builderResponseData),this.unhideFormDeleteButton(e),this.getModelList().fileList("markActive",t.builderResponseData.tabId),this.getIndexController().unchangeTab(e),this.updateDataRegistry(t)},i.prototype.deleteConfirmed=function(){var e=this.getMasterTabsActivePane(),o=e.find("form");t.oc.stripeLoadIndicator.show(),o.request("onModelListDelete").always(t.oc.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.deleteDone))},i.prototype.deleteDone=function(t){var e=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(e),this.forceCloseTab(e),this.updateDataRegistry(t)},i.prototype.getTableControlObject=function(t){var e=t.closest("form"),o=e.find("[data-control=table]"),i=o.data("oc.table");if(!i)throw new Error("Table object is not found on the model list tab");return i},i.prototype.getModelList=function(){return t("#layout-side-panel form[data-content-id=models] [data-control=filelist]")},i.prototype.validateTable=function(t){var e=this.getTableControlObject(t);return e.unfocusTable(),e.validate()},i.prototype.getTableData=function(t){var e=this.getTableControlObject(t);return e.dataSource.getAllData()},i.prototype.loadModelFields=function(e,o){var i=t(e).closest("form"),r=i.find("input[name=model_class]").val(),n=i.data("oc.model-field-cache");return void 0!==n?void o(n):(void 0===this.cachedModelFieldsPromises[r]&&(this.cachedModelFieldsPromises[r]=i.request("onModelFormGetModelFields",{data:{as_plain_list:1}})),void(void 0!==o&&this.cachedModelFieldsPromises[r].done(function(t){i.data("oc.model-field-cache",t.responseData.options),o(t.responseData.options)})))},i.prototype.updateDataRegistry=function(e){if(void 0!==e.builderResponseData.registryData){var o=e.builderResponseData.registryData;t.oc.builder.dataRegistry.set(o.pluginCode,"model-lists",o.modelClass,o.lists),t.oc.builder.dataRegistry.clearCache(o.pluginCode,"plugin-lists")}},i.prototype.onAutocompleteItems=function(t,e){return"model-fields"===e.columnConfiguration.fillFrom?(t.preventDefault(),this.loadModelFields(t.target,e.callback),!1):void 0},t.oc.builder.entityControllers.modelList=i}(window.jQuery),+function(t){"use strict";void 0===t.oc.builder&&(t.oc.builder={}),void 0===t.oc.builder.entityControllers&&(t.oc.builder.entityControllers={});var e=t.oc.builder.entityControllers.base,o=e.prototype,i=function(t){e.call(this,"permissions",t)};i.prototype=Object.create(o),i.prototype.constructor=i,i.prototype.registerHandlers=function(){this.indexController.$masterTabs.on("oc.tableNewRow",this.proxy(this.onTableRowCreated))},i.prototype.cmdOpenPermissions=function(e){var o=this.getSelectedPlugin();return o?void this.indexController.openOrLoadMasterTab(t(e.target),"onPermissionsOpen",this.makeTabId(o)):void alert("Please select a plugin first")},i.prototype.cmdSavePermissions=function(e){var o=t(e.currentTarget),i=o.closest("form");this.validateTable(o)&&o.request("onPermissionsSave",{data:{permissions:this.getTableData(o)}}).done(this.proxy(this.savePermissionsDone))},i.prototype.getTableControlObject=function(t){var e=t.closest("form"),o=e.find("[data-control=table]"),i=o.data("oc.table");if(!i)throw new Error("Table object is not found on permissions tab");return i},i.prototype.validateTable=function(t){var e=this.getTableControlObject(t);return e.unfocusTable(),e.validate()},i.prototype.getTableData=function(t){var e=this.getTableControlObject(t);return e.dataSource.getAllData()},i.prototype.savePermissionsDone=function(e){if(void 0===e.builderResponseData)throw new Error("Invalid response data");var o=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(o),t.oc.builder.dataRegistry.clearCache(e.builderResponseData.pluginCode,"permissions")},i.prototype.onTableRowCreated=function(e,o){var i=t(e.target);if("permissions"==i.data("alias")){var r=i.closest("form");if("permissions"==r.data("entity")){var n=r.find("input[name=plugin_code]").val();o.permission=n.toLowerCase()+"."}}},t.oc.builder.entityControllers.permission=i}(window.jQuery),+function(t){"use strict";void 0===t.oc.builder&&(t.oc.builder={}),void 0===t.oc.builder.entityControllers&&(t.oc.builder.entityControllers={});var e=t.oc.builder.entityControllers.base,o=e.prototype,i=function(t){e.call(this,"plugin",t),this.popupZIndex=5050};i.prototype=Object.create(o),i.prototype.constructor=i,i.prototype.cmdMakePluginActive=function(e){var o=t(e.currentTarget),i=o.data("pluginCode");this.makePluginActive(i)},i.prototype.cmdCreatePlugin=function(e){var o=t(e.currentTarget);o.one("shown.oc.popup",this.proxy(this.onPluginPopupShown)),o.popup({handler:"onPluginLoadPopup",zIndex:this.popupZIndex})},i.prototype.cmdApplyPluginSettings=function(e){var o=t(e.currentTarget),i=this;t.oc.stripeLoadIndicator.show(),o.request("onPluginSave").always(t.oc.builder.indexController.hideStripeIndicatorProxy).done(function(t){o.trigger("close.oc.popup"),i.applyPluginSettingsDone(t)})},i.prototype.cmdEditPluginSettings=function(e){var o=t(e.currentTarget);o.one("shown.oc.popup",this.proxy(this.onPluginPopupShown)),o.popup({handler:"onPluginLoadPopup",zIndex:this.popupZIndex,extraData:{pluginCode:o.data("pluginCode")}})},i.prototype.onPluginPopupShown=function(e,o,i){t(i).find("input[name=name]").focus()},i.prototype.applyPluginSettingsDone=function(t){void 0!==t.responseData&&void 0!==t.responseData.isNewPlugin&&this.makePluginActive(t.responseData.pluginCode,!0)},i.prototype.makePluginActive=function(e,o){var i=t("#builder-plugin-selector-panel form").first();t.oc.stripeLoadIndicator.show(),i.request("onPluginSetActive",{data:{pluginCode:e,updatePluginList:o?1:0}}).always(t.oc.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.makePluginActiveDone))},i.prototype.makePluginActiveDone=function(e){var o=e.responseData.pluginCode;t("#builder-plugin-selector-panel [data-control=filelist]").fileList("markActive",o)},t.oc.builder.entityControllers.plugin=i}(window.jQuery),+function(t){"use strict";void 0===t.oc.builder&&(t.oc.builder={}),void 0===t.oc.builder.entityControllers&&(t.oc.builder.entityControllers={});var e=t.oc.builder.entityControllers.base,o=e.prototype,i=function(t){e.call(this,"version",t),this.hiddenHints={}};i.prototype=Object.create(o),i.prototype.constructor=i,i.prototype.cmdCreateVersion=function(e){var o=t(e.currentTarget),i=o.data("versionType");this.indexController.openOrLoadMasterTab(o,"onVersionCreateOrOpen",this.newTabId(),{version_type:i})},i.prototype.cmdSaveVersion=function(e){var o=t(e.currentTarget),i=o.closest("form");o.request("onVersionSave").done(this.proxy(this.saveVersionDone))},i.prototype.cmdOpenVersion=function(e){var o=t(e.currentTarget).data("id"),i=t(e.currentTarget).data("pluginCode");this.indexController.openOrLoadMasterTab(t(e.target),"onVersionCreateOrOpen",this.makeTabId(i+"-"+o),{original_version:o})},i.prototype.cmdDeleteVersion=function(e){var o=t(e.currentTarget);t.oc.confirm(o.data("confirm"),this.proxy(this.deleteConfirmed))},i.prototype.cmdApplyVersion=function(e){var o=t(e.currentTarget),i=o.closest("div.tab-pane"),r=this;this.showHintPopup(i,"builder-version-apply",function(){o.request("onVersionApply").done(r.proxy(r.applyVersionDone))})},i.prototype.cmdRollbackVersion=function(e){var o=t(e.currentTarget),i=o.closest("div.tab-pane"),r=this;this.showHintPopup(i,"builder-version-rollback",function(){o.request("onVersionRollback").done(r.proxy(r.rollbackVersionDone))})},i.prototype.saveVersionDone=function(t){if(void 0===t.builderResponseData)throw new Error("Invalid response data");var e=this.getMasterTabsActivePane();this.updateUiAfterSave(e,t),t.builderResponseData.isApplied||this.showSavedNotAppliedHint(e)},i.prototype.showSavedNotAppliedHint=function(t){this.showHintPopup(t,"builder-version-save-unapplied")},i.prototype.showHintPopup=function(e,o,i){return this.getDontShowHintAgain(o,e)?void(i&&i.apply(this)):(e.one("hide.oc.popup",this.proxy(this.onHintPopupHide)),i&&e.one("shown.oc.popup",function(e,o,r){r.find("form").one("submit",function(e){return i.apply(this),e.preventDefault(),t(e.target).trigger("close.oc.popup"),!1})}),void e.popup({content:this.getPopupContent(e,o)}))},i.prototype.onHintPopupHide=function(t,e,o){var i=o.find("input[type=checkbox][name=dont_show_again]").is(":checked"),r=o.find("input[type=hidden][name=hint_code]").val();if(o.find("form").off("submit"),i){var n=this.getMasterTabsActivePane().find('form[data-entity="versions"]');n.request("onHideBackendHint",{data:{name:r}}),this.setDontShowHintAgain(r)}},i.prototype.setDontShowHintAgain=function(t){this.hiddenHints[t]=!0},i.prototype.getDontShowHintAgain=function(t,e){return void 0!==this.hiddenHints[t]?this.hiddenHints[t]:"true"==e.find('input[type=hidden][data-hint-hidden="'+t+'"]').val()},i.prototype.getPopupContent=function(t,e){var o=t.find('script[data-version-hint-template="'+e+'"]');if(0===o.length)throw new Error("Version popup template not found: "+e);return o.html()},i.prototype.updateUiAfterSave=function(t,e){t.find("input[name=original_version]").val(e.builderResponseData.savedVersion),this.updateMasterTabIdAndTitle(t,e.builderResponseData),this.unhideFormDeleteButton(t),this.getVersionList().fileList("markActive",e.builderResponseData.tabId),this.getIndexController().unchangeTab(t)},i.prototype.deleteConfirmed=function(){var e=this.getMasterTabsActivePane(),o=e.find("form");t.oc.stripeLoadIndicator.show(),o.request("onVersionDelete").always(t.oc.builder.indexController.hideStripeIndicatorProxy).done(this.proxy(this.deleteDone))},i.prototype.deleteDone=function(){var t=this.getMasterTabsActivePane();this.getIndexController().unchangeTab(t),this.forceCloseTab(t)},i.prototype.applyVersionDone=function(t){if(void 0===t.builderResponseData)throw new Error("Invalid response data");var e=this.getMasterTabsActivePane();this.updateUiAfterSave(e,t),this.updateVersionsButtons()},i.prototype.rollbackVersionDone=function(t){if(void 0===t.builderResponseData)throw new Error("Invalid response data");var e=this.getMasterTabsActivePane();this.updateUiAfterSave(e,t),this.updateVersionsButtons()},i.prototype.getVersionList=function(){return t("#layout-side-panel form[data-content-id=version] [data-control=filelist]")},i.prototype.updateVersionsButtons=function(){for(var e=this.getMasterTabsObject(),o=e.$tabsContainer.find("> li"),i=this.getVersionList(),r=o.length-1;r>=0;r--){var n=t(o[r]),a=n.data("tabId");if(a&&0!=String(a).length){var s=i.find('li[data-id="'+a+'"]');if(s.length){var l=s.data("applied"),d=e.findPaneFromTab(n);l?(d.find('[data-builder-command="version:cmdApplyVersion"]').addClass("hide"),d.find('[data-builder-command="version:cmdRollbackVersion"]').removeClass("hide")):(d.find('[data-builder-command="version:cmdApplyVersion"]').removeClass("hide"),d.find('[data-builder-command="version:cmdRollbackVersion"]').addClass("hide"))
}}}},t.oc.builder.entityControllers.version=i}(window.jQuery),+function(t){"use strict";void 0===t.oc.builder&&(t.oc.builder={});var e=t.oc.foundation.base,o=e.prototype,i=function(){e.call(this),this.$masterTabs=null,this.masterTabsObj=null,this.hideStripeIndicatorProxy=null,this.entityControllers={},this.init()};i.prototype=Object.create(o),i.prototype.constructor=i,i.prototype.dispose=function(){o.dispose.call(this)},i.prototype.openOrLoadMasterTab=function(e,o,i,r){if(this.masterTabsObj.goTo(i))return!1;var n=void 0===r?{}:r;t.oc.stripeLoadIndicator.show();var a=e.request(o,{data:n}).done(this.proxy(this.addMasterTab)).always(this.hideStripeIndicatorProxy);return a},i.prototype.getMasterTabActivePane=function(){return this.$masterTabs.find("> .tab-content > .tab-pane.active")},i.prototype.unchangeTab=function(t){t.find("form").trigger("unchange.oc.changeMonitor")},i.prototype.triggerCommand=function(t,e){var o=t.split(":");if(2===o.length){var i=o[0],r=o[1];if(void 0===this.entityControllers[i])throw new Error("Unknown entity type: "+i);this.entityControllers[i].invokeCommand(r,e)}},i.prototype.init=function(){this.$masterTabs=t("#builder-master-tabs"),this.$sidePanel=t("#builder-side-panel"),this.masterTabsObj=this.$masterTabs.data("oc.tab"),this.hideStripeIndicatorProxy=this.proxy(this.hideStripeIndicator),new t.oc.tabFormExpandControls(this.$masterTabs),this.createEntityControllers(),this.registerHandlers()},i.prototype.createEntityControllers=function(){for(var e in t.oc.builder.entityControllers)"base"!=e&&(this.entityControllers[e]=new t.oc.builder.entityControllers[e](this))},i.prototype.registerHandlers=function(){t(document).on("click","[data-builder-command]",this.proxy(this.onCommand)),t(document).on("submit","[data-builder-command]",this.proxy(this.onCommand)),this.$masterTabs.on("changed.oc.changeMonitor",this.proxy(this.onFormChanged)),this.$masterTabs.on("unchanged.oc.changeMonitor",this.proxy(this.onFormUnchanged)),this.$masterTabs.on("shown.bs.tab",this.proxy(this.onTabShown)),this.$masterTabs.on("afterAllClosed.oc.tab",this.proxy(this.onAllTabsClosed)),this.$masterTabs.on("closed.oc.tab",this.proxy(this.onTabClosed)),this.$masterTabs.on("autocompleteitems.oc.inspector",this.proxy(this.onDataRegistryItems)),this.$masterTabs.on("dropdownoptions.oc.inspector",this.proxy(this.onDataRegistryItems));for(var e in this.entityControllers)void 0!==this.entityControllers[e].registerHandlers&&this.entityControllers[e].registerHandlers()},i.prototype.hideStripeIndicator=function(){t.oc.stripeLoadIndicator.hide()},i.prototype.addMasterTab=function(t){if(this.masterTabsObj.addTab(t.tabTitle,t.tab,t.tabId,"oc-"+t.tabIcon),t.isNewRecord){var e=this.getMasterTabActivePane();e.find("form").one("ready.oc.changeMonitor",this.proxy(this.onChangeMonitorReady))}},i.prototype.updateModifiedCounter=function(){var e={database:{menu:"database",count:0},models:{menu:"models",count:0},permissions:{menu:"permissions",count:0},menus:{menu:"menus",count:0},versions:{menu:"versions",count:0},localization:{menu:"localization",count:0},controller:{menu:"controllers",count:0}};t("> div.tab-content > div.tab-pane[data-modified] > form",this.$masterTabs).each(function(){var o=t(this).data("entity");e[o].count++}),t.each(e,function(e,o){t.oc.sideNav.setCounter("builder/"+o.menu,o.count)})},i.prototype.getFormPluginCode=function(e){var o=t(e).closest("form"),i=o.find('input[name="plugin_code"]'),r=i.val();if(!r)throw new Error("Plugin code input is not found in the form.");return r},i.prototype.setPageTitle=function(e){t.oc.layout.setPageTitle(e.length?e+" | ":e)},i.prototype.getFileLists=function(){return t("[data-control=filelist]",this.$sidePanel)},i.prototype.dataToInspectorArray=function(t){var e=[];for(var o in t){var i={title:t[o],value:o};e.push(i)}return e},i.prototype.onCommand=function(e){if("FORM"!=e.currentTarget.tagName||"click"!=e.type){var o=t(e.currentTarget).data("builderCommand");this.triggerCommand(o,e);var i=t(e.currentTarget);if("A"!==e.currentTarget.tagName||"menuitem"!=i.attr("role")||"javascript:;"!=i.attr("href"))return e.preventDefault(),!1}},i.prototype.onFormChanged=function(e){t(".form-tabless-fields",e.target).trigger("modified.oc.tab"),this.updateModifiedCounter()},i.prototype.onFormUnchanged=function(e){t(".form-tabless-fields",e.target).trigger("unmodified.oc.tab"),this.updateModifiedCounter()},i.prototype.onTabShown=function(e){var o=t(e.target).closest("[data-control=tab]");if(o.attr("id")==this.$masterTabs.attr("id")){var i=t(e.target).closest("li").attr("data-tab-id"),r=t(e.target).attr("title");r&&this.setPageTitle(r),this.getFileLists().fileList("markActive",i),t(window).trigger("resize")}},i.prototype.onAllTabsClosed=function(t){this.setPageTitle(""),this.getFileLists().fileList("markActive",null)},i.prototype.onTabClosed=function(e,o,i){t(i).find("form").off("ready.oc.changeMonitor",this.proxy(this.onChangeMonitorReady)),this.updateModifiedCounter()},i.prototype.onChangeMonitorReady=function(e){t(e.target).trigger("change")},i.prototype.onDataRegistryItems=function(e,o){var i=this;if("model-classes"==o.propertyDefinition.fillFrom||"model-forms"==o.propertyDefinition.fillFrom||"model-lists"==o.propertyDefinition.fillFrom||"controller-urls"==o.propertyDefinition.fillFrom||"model-columns"==o.propertyDefinition.fillFrom||"plugin-lists"==o.propertyDefinition.fillFrom||"permissions"==o.propertyDefinition.fillFrom){e.preventDefault();var r=null,n=o.propertyDefinition.subtypeFrom;void 0!==n&&(r=o.values[n]),t.oc.builder.dataRegistry.get(t(e.target),this.getFormPluginCode(e.target),o.propertyDefinition.fillFrom,r,function(t){o.callback({options:i.dataToInspectorArray(t)})})}},t(document).ready(function(){t.oc.builder.indexController=new i})}(window.jQuery),+function(t){"use strict";var e=t.oc.inspector.propertyEditors.string,o=e.prototype,i=function(t,o,i,r){this.localizationInput=null,e.call(this,t,o,i,r)};i.prototype=Object.create(o),i.prototype.constructor=e,i.prototype.dispose=function(){this.removeLocalizationInput(),o.dispose.call(this)},i.prototype.build=function(){var e=document.createElement("div"),o=document.createElement("input"),i=void 0!==this.propertyDefinition.placeholder?this.propertyDefinition.placeholder:"",r=this.inspector.getPropertyValue(this.propertyDefinition.property);o.setAttribute("type","text"),o.setAttribute("class","string-editor"),o.setAttribute("placeholder",i),e.setAttribute("class","autocomplete-container"),void 0===r&&(r=this.propertyDefinition.default),void 0===r&&(r=""),o.value=r,t.oc.foundation.element.addClass(this.containerCell,"text autocomplete"),e.appendChild(o),this.containerCell.appendChild(e),this.buildLocalizationEditor()},i.prototype.buildLocalizationEditor=function(){this.localizationInput=new t.oc.builder.localizationInput(this.getInput(),this.getForm(),{plugin:this.getPluginCode()})},i.prototype.removeLocalizationInput=function(){this.localizationInput.dispose(),this.localizationInput=null},i.prototype.supportsExternalParameterEditor=function(){return!1},i.prototype.registerHandlers=function(){o.registerHandlers.call(this),t(this.getInput()).on("change",this.proxy(this.onInputKeyUp))},i.prototype.unregisterHandlers=function(){o.unregisterHandlers.call(this),t(this.getInput()).off("change",this.proxy(this.onInputKeyUp))},i.prototype.getForm=function(){var e=this.getRootSurface().getInspectableElement();if(!e)throw new Error("Cannot determine inspectable element in the Builder localization editor.");return t(e).closest("form")},i.prototype.getPluginCode=function(){var t=this.getForm(),e=t.find("input[name=plugin_code]");if(!e.length)throw new Error('The input "plugin_code" should be defined in the form in order to use the localization Inspector editor.');return e.val()},t.oc.inspector.propertyEditors.builderLocalization=i}(window.jQuery),+function(t){"use strict";void 0===t.oc.builder&&(t.oc.builder={});var e=t.oc.foundation.base,o=e.prototype,i=function(o,r,n){this.input=o,this.form=r,this.options=t.extend({},i.DEFAULTS,n),this.disposed=!1,this.initialized=!1,this.newStringPopupMarkup=null,e.call(this),this.init()};i.prototype=Object.create(o),i.prototype.constructor=i,i.prototype.dispose=function(){this.unregisterHandlers(),this.form=null,this.options.beforePopupShowCallback=null,this.options.afterPopupHideCallback=null,this.options=null,this.disposed=!0,this.newStringPopupMarkup=null,this.initialized&&t(this.input).autocomplete("destroy"),t(this.input).removeData("localization-input"),this.input=null,o.dispose.call(this)},i.prototype.init=function(){if(!this.options.plugin)throw new Error("The options.plugin value should be set in the localization input object.");var e=t(this.input);e.data("localization-input",this),e.attr("data-builder-localization-input","true"),e.attr("data-builder-localization-plugin",this.options.plugin),this.getContainer().addClass("localization-input-container"),this.registerHandlers(),this.loadDataAndBuild()},i.prototype.buildAddLink=function(){var e=this.getContainer();if(!(e.find("a.localization-trigger").length>0)){var o=document.createElement("a");o.setAttribute("class","oc-icon-plus localization-trigger"),o.setAttribute("href","#");var i=e.position();t(o).css({top:i.top+4,right:7}),e.append(o)}},i.prototype.loadDataAndBuild=function(){this.showLoadingIndicator();var e=t.oc.builder.dataRegistry.get(this.form,this.options.plugin,"localization",null,this.proxy(this.dataLoaded)),o=this;e&&e.always(function(){o.hideLoadingIndicator()})},i.prototype.reload=function(){t.oc.builder.dataRegistry.get(this.form,this.options.plugin,"localization",null,this.proxy(this.dataLoaded))},i.prototype.dataLoaded=function(e){if(!this.disposed){var o=t(this.input),i=o.data("autocomplete");if(i)i.source=this.preprocessData(e);else{this.hideLoadingIndicator();var r={source:this.preprocessData(e),matchWidth:!0};r=t.extend(r,this.options.autocompleteOptions),t(this.input).autocomplete(r),this.initialized=!0}}},i.prototype.preprocessData=function(e){var o=t.extend({},e);for(var i in o)o[i]=i+" - "+o[i];return o},i.prototype.getContainer=function(){return t(this.input).closest(".autocomplete-container")},i.prototype.showLoadingIndicator=function(){var t=this.getContainer();t.addClass("loading-indicator-container size-small"),t.loadIndicator()},i.prototype.hideLoadingIndicator=function(){var t=this.getContainer();t.loadIndicator("hide"),t.loadIndicator("destroy"),t.removeClass("loading-indicator-container")},i.prototype.loadAndShowPopup=function(){null===this.newStringPopupMarkup?(t.oc.stripeLoadIndicator.show(),t(this.input).request("onLanguageLoadAddStringForm").done(this.proxy(this.popupMarkupLoaded)).always(function(){t.oc.stripeLoadIndicator.hide()})):this.showPopup()},i.prototype.popupMarkupLoaded=function(t){this.newStringPopupMarkup=t.markup,this.showPopup()},i.prototype.showPopup=function(){var e=t(this.input);e.popup({content:this.newStringPopupMarkup});var o=e.data("oc.popup").$content,i=o.find("#language_string_key");t.oc.builder.dataRegistry.get(this.form,this.options.plugin,"localization","sections",function(t){i.autocomplete({source:t,matchWidth:!0})}),o.find("form").on("submit",this.proxy(this.onSubmitPopupForm))},i.prototype.stringCreated=function(e){if(void 0===e.localizationData||void 0===e.registryData)throw new Error("Invalid server response.");var o=t(this.input);o.val(e.localizationData.key),t.oc.builder.dataRegistry.set(this.options.plugin,"localization",null,e.registryData.strings),t.oc.builder.dataRegistry.set(this.options.plugin,"localization","sections",e.registryData.sections),o.data("oc.popup").hide(),o.trigger("change")},i.prototype.onSubmitPopupForm=function(e){var o=t(e.target);return t.oc.stripeLoadIndicator.show(),o.request("onLanguageCreateString",{data:{plugin_code:this.options.plugin}}).done(this.proxy(this.stringCreated)).always(function(){t.oc.stripeLoadIndicator.hide()}),e.preventDefault(),!1},i.prototype.onPopupHidden=function(e,o,i){t(i).find("#language_string_key").autocomplete("destroy"),t(i).find("form").on("submit",this.proxy(this.onSubmitPopupForm)),this.options.afterPopupHideCallback&&this.options.afterPopupHideCallback()},i.updatePluginInputs=function(e){for(var o=document.body.querySelectorAll('input[data-builder-localization-input][data-builder-localization-plugin="'+e+'"]'),i=o.length-1;i>=0;i--)t(o[i]).data("localization-input").reload()},i.prototype.unregisterHandlers=function(){this.input.removeEventListener("focus",this.proxy(this.onInputFocus)),this.getContainer().off("click","a.localization-trigger",this.proxy(this.onTriggerClick)),t(this.input).off("hidden.oc.popup",this.proxy(this.onPopupHidden))},i.prototype.registerHandlers=function(){this.input.addEventListener("focus",this.proxy(this.onInputFocus)),this.getContainer().on("click","a.localization-trigger",this.proxy(this.onTriggerClick)),t(this.input).on("hidden.oc.popup",this.proxy(this.onPopupHidden))},i.prototype.onInputFocus=function(){this.buildAddLink()},i.prototype.onTriggerClick=function(t){return this.options.beforePopupShowCallback&&this.options.beforePopupShowCallback(),this.loadAndShowPopup(),t.preventDefault(),!1},i.DEFAULTS={plugin:null,autocompleteOptions:{},beforePopupShowCallback:null,afterPopupHideCallback:null},t.oc.builder.localizationInput=i}(window.jQuery),+function(t){"use strict";if(void 0===t.oc.table)throw new Error("The $.oc.table namespace is not defined. Make sure that the table.js script is loaded.");if(void 0===t.oc.table.processor)throw new Error("The $.oc.table.processor namespace is not defined. Make sure that the table.processor.base.js script is loaded.");var e=t.oc.table.processor.string,o=e.prototype,i=function(t,o,i){this.localizationInput=null,this.popupDisplayed=!1,e.call(this,t,o,i)};i.prototype=Object.create(o),i.prototype.constructor=i,i.prototype.dispose=function(){this.removeLocalizationInput(),o.dispose.call(this)},i.prototype.onUnfocus=function(){this.activeCell&&!this.popupDisplayed&&(this.removeLocalizationInput(),o.onUnfocus.call(this))},i.prototype.onBeforePopupShow=function(){this.popupDisplayed=!0},i.prototype.onAfterPopupHide=function(){this.popupDisplayed=!1},i.prototype.renderCell=function(t,e){o.renderCell.call(this,t,e)},i.prototype.buildEditor=function(e,i,r){o.buildEditor.call(this,e,i,r),t.oc.foundation.element.addClass(i,"autocomplete-container"),this.buildLocalizationEditor()},i.prototype.buildLocalizationEditor=function(){var e=this.getInput();this.localizationInput=new t.oc.builder.localizationInput(e,t(e),{plugin:this.getPluginCode(e),beforePopupShowCallback:t.proxy(this.onBeforePopupShow,this),afterPopupHideCallback:t.proxy(this.onAfterPopupHide,this),autocompleteOptions:{menu:'<ul class="autocomplete dropdown-menu table-widget-autocomplete localization"></ul>',bodyContainer:!0}})},i.prototype.getInput=function(){return this.activeCell?this.activeCell.querySelector(".string-input"):null},i.prototype.getPluginCode=function(e){var o=t(e).closest("form"),i=o.find("input[name=plugin_code]");if(!i.length)throw new Error('The input "plugin_code" should be defined in the form in order to use the localization table processor.');return i.val()},i.prototype.removeLocalizationInput=function(){this.localizationInput&&(this.localizationInput.dispose(),this.localizationInput=null)},t.oc.table.processor.builderLocalization=i}(window.jQuery);